---
---

<section class="mb-[50px]">
  <h2 class="text-lg font-semibold text-white mb-5">X Timeline</h2>
  <div id="timeline-container" class="bg-gray-200 border border-gray-300 rounded-xl p-5 overflow-hidden max-tablet:hidden min-h-[600px]">
    <div class="text-gray-700 text-center py-10">Loading timeline...</div>
  </div>
  <div class="hidden max-tablet:block">
    <a href="https://twitter.com/enjoydarts" class="flex items-center justify-center gap-3 px-8 py-4 bg-gray-200 border border-gray-300 rounded-xl text-gray-700 no-underline text-base font-medium transition-all duration-200 hover:bg-gray-300 hover:border-cyan hover:text-cyan hover:-translate-y-[2px] hover:shadow-[0_4px_12px_rgba(0,212,255,0.2)]" target="_blank" rel="noopener">
      <svg class="w-6 h-6 flex-shrink-0" viewBox="0 0 24 24" fill="currentColor">
        <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
      </svg>
      <span>Follow me on X</span>
    </a>
  </div>
</section>

<script is:inline>
  (function() {
    var retryCount = 0;
    var maxRetries = 50; // 最大5秒待つ (100ms * 50)

    function initTwitterWidget() {
      if (typeof window.twttr !== 'undefined' && window.twttr.widgets) {
        console.log('Twitter widgets API loaded');
        console.log('twttr.widgets:', window.twttr.widgets);
        console.log('createTimeline function:', window.twttr.widgets.createTimeline);

        var container = document.getElementById('timeline-container');

        if (container) {
          console.log('Creating timeline with createTimeline()');
          console.log('Container element:', container);

          // ローディングメッセージをクリア
          container.innerHTML = '';

          var timeoutId;
          var isResolved = false;

          // タイムアウト処理（5秒待つ）
          timeoutId = setTimeout(function() {
            if (!isResolved) {
              console.error('Timeline creation timed out after 5 seconds');
              console.log('Checking network tab for blocked requests to syndication.twitter.com');
              container.innerHTML = '<div class="text-gray-700 text-center py-10">Timeline loading timed out. This may be caused by:<br>1. Firefox Enhanced Tracking Protection<br>2. Ad blocker<br>3. Network issues<br><br>Check the Network tab in Developer Tools for blocked requests.</div>';
            }
          }, 5000);

          try {
            var promise = window.twttr.widgets.createTimeline(
              {
                sourceType: 'profile',
                screenName: 'enjoydarts'
              },
              container,
              {
                height: 600,
                theme: 'dark',
                chrome: 'noheader nofooter noborders transparent'
              }
            );

            console.log('createTimeline returned:', promise);

            if (promise && typeof promise.then === 'function') {
              promise.then(function(el) {
                isResolved = true;
                clearTimeout(timeoutId);
                console.log('Timeline created successfully:', el);
                if (el) {
                  console.log('iframe src:', el.src);
                  console.log('iframe dimensions:', el.offsetWidth, 'x', el.offsetHeight);
                } else {
                  console.warn('Timeline element is null');
                  container.innerHTML = '<div class="text-gray-700 text-center py-10">Timeline could not be loaded.</div>';
                }
              }).catch(function(err) {
                isResolved = true;
                clearTimeout(timeoutId);
                console.error('Failed to create timeline:', err);
                container.innerHTML = '<div class="text-gray-700 text-center py-10">Failed to load timeline: ' + err.message + '</div>';
              });
            } else {
              console.error('createTimeline did not return a Promise:', promise);
              clearTimeout(timeoutId);
            }
          } catch (e) {
            isResolved = true;
            clearTimeout(timeoutId);
            console.error('Exception while calling createTimeline:', e);
            container.innerHTML = '<div class="text-gray-700 text-center py-10">Error: ' + e.message + '</div>';
          }
        } else {
          console.error('Timeline container not found');
        }
      } else {
        retryCount++;
        if (retryCount < maxRetries) {
          setTimeout(initTwitterWidget, 100);
        } else {
          console.warn('Twitter widgets failed to load after ' + (maxRetries * 100) + 'ms');
          var container = document.getElementById('timeline-container');
          if (container) {
            container.innerHTML = '<div class="text-gray-700 text-center py-10">Twitter widgets script failed to load</div>';
          }
        }
      }
    }

    // ページ読み込み後に初期化
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initTwitterWidget);
    } else {
      initTwitterWidget();
    }
  })();
</script>
