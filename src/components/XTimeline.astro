---
---

<section class="mb-[50px]">
  <h2 class="text-lg font-semibold text-white mb-5">X Timeline</h2>
  <div id="timeline-container" class="bg-gray-200 border border-gray-300 rounded-xl p-5 overflow-hidden max-tablet:hidden">
    <a
      class="twitter-timeline"
      data-height="600"
      data-theme="dark"
      data-chrome="noheader nofooter noborders transparent"
      href="https://twitter.com/enjoydarts?ref_src=twsrc%5Etfw"
    >
      Loading timeline...
    </a>
  </div>
  <div class="hidden max-tablet:block">
    <a href="https://twitter.com/enjoydarts" class="flex items-center justify-center gap-3 px-8 py-4 bg-gray-200 border border-gray-300 rounded-xl text-gray-700 no-underline text-base font-medium transition-all duration-200 hover:bg-gray-300 hover:border-cyan hover:text-cyan hover:-translate-y-[2px] hover:shadow-[0_4px_12px_rgba(0,212,255,0.2)]" target="_blank" rel="noopener">
      <svg class="w-6 h-6 flex-shrink-0" viewBox="0 0 24 24" fill="currentColor">
        <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
      </svg>
      <span>Follow me on X</span>
    </a>
  </div>
</section>

<script is:inline>
  (function() {
    var retryCount = 0;
    var maxRetries = 50; // 最大5秒待つ (100ms * 50)

    function initTwitterWidget() {
      if (typeof window.twttr !== 'undefined' && window.twttr.widgets) {
        console.log('Twitter widgets loaded, initializing timeline');
        var container = document.getElementById('timeline-container');
        console.log('Timeline container:', container);

        if (container) {
          try {
            // 既存のタイムラインをクリア
            var existingTimeline = container.querySelector('.twitter-timeline');
            console.log('Existing timeline element:', existingTimeline);

            // widgets.load()を呼び出す
            var result = window.twttr.widgets.load(container);
            console.log('widgets.load() result:', result);

            // 代替案: 直接createTimelineを試す
            setTimeout(function() {
              var timeline = container.querySelector('iframe');
              if (!timeline) {
                console.warn('No iframe found, trying createTimeline');
                window.twttr.widgets.createTimeline(
                  {
                    sourceType: 'profile',
                    screenName: 'enjoydarts'
                  },
                  container,
                  {
                    height: 600,
                    theme: 'dark',
                    chrome: 'noheader nofooter noborders transparent'
                  }
                ).then(function(el) {
                  console.log('Timeline created:', el);
                }).catch(function(err) {
                  console.error('Failed to create timeline:', err);
                });
              } else {
                console.log('Timeline iframe found');
              }
            }, 1000);
          } catch (e) {
            console.error('Failed to load Twitter timeline:', e);
          }
        } else {
          console.error('Timeline container not found');
        }
      } else {
        retryCount++;
        if (retryCount < maxRetries) {
          setTimeout(initTwitterWidget, 100);
        } else {
          console.warn('Twitter widgets failed to load after ' + (maxRetries * 100) + 'ms');
        }
      }
    }

    // ページ読み込み後に初期化
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initTwitterWidget);
    } else {
      initTwitterWidget();
    }
  })();
</script>
